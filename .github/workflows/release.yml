name: Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:
    inputs:
      tag:
        description: 'Tag to release (e.g., v1.0.0)'
        required: true
        type: string

jobs:
  # ============================================================================
  # Build OBS SDK for Linux (needed for plugin build)
  # ============================================================================

  build-obs-linux:
    name: Build OBS SDK (Linux)
    runs-on: ubuntu-22.04

    steps:
    - name: Cache OBS Studio SDK
      id: cache-obs
      uses: actions/cache@v4
      with:
        path: obs-studio/build/install
        key: obs-sdk-linux-30.2.0

    - name: Install OBS dependencies
      if: steps.cache-obs.outputs.cache-hit != 'true'
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          cmake \
          git \
          ninja-build \
          pkg-config \
          qtbase5-dev \
          libqt5svg5-dev \
          libavcodec-dev \
          libavdevice-dev \
          libavfilter-dev \
          libavformat-dev \
          libavutil-dev \
          libswresample-dev \
          libswscale-dev \
          libx264-dev \
          libcurl4-openssl-dev \
          libmbedtls-dev \
          libgl1-mesa-dev \
          libjansson-dev \
          libluajit-5.1-dev \
          python3-dev \
          libx11-dev \
          libxcb-xinput-dev \
          libxcb-randr0-dev \
          libxcb-xfixes0-dev \
          libx11-xcb-dev \
          libxcb1-dev \
          libxcb-keysyms1-dev \
          libxcb-shm0-dev \
          libxcb-xinerama0-dev \
          libasound2-dev \
          libpulse-dev \
          libwayland-dev \
          libdrm-dev \
          uthash-dev \
          libxkbcommon-dev \
          libxcb-composite0-dev \
          libv4l-dev

    - name: Build OBS Studio SDK
      if: steps.cache-obs.outputs.cache-hit != 'true'
      run: |
        git clone --recursive https://github.com/obsproject/obs-studio.git
        cd obs-studio
        git checkout 30.2.0

        # Create CMake preset for minimal SDK build
        cat > CMakeUserPresets.json << 'PRESET_EOF'
        {
          "version": 3,
          "configurePresets": [
            {
              "name": "ci-linux-minimal",
              "displayName": "Linux Minimal SDK",
              "binaryDir": "${sourceDir}/build",
              "generator": "Ninja",
              "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Release",
                "CMAKE_INSTALL_PREFIX": "${sourceDir}/build/install",
                "ENABLE_BROWSER": false,
                "ENABLE_WEBSOCKET": false,
                "ENABLE_SCRIPTING": false,
                "ENABLE_UI": false,
                "BUILD_TESTS": false,
                "ENABLE_PLUGINS": false,
                "ENABLE_AJA": false,
                "ENABLE_ALSA": false,
                "ENABLE_JACK": false,
                "ENABLE_PIPEWIRE": false,
                "ENABLE_PULSEAUDIO": false,
                "ENABLE_V4L2": false,
                "ENABLE_VLC": false,
                "ENABLE_WAYLAND": false
              }
            }
          ]
        }
        PRESET_EOF

        cmake --preset ci-linux-minimal
        cmake --build build --target obs-frontend-api
        cmake --build build --target install

    - name: Upload OBS SDK
      uses: actions/upload-artifact@v4
      with:
        name: obs-sdk-linux
        path: obs-studio/build/install
        retention-days: 1

  # ============================================================================
  # Build Plugin Binaries
  # ============================================================================

  build-linux:
    name: Build Plugin (Linux)
    runs-on: ubuntu-22.04
    needs: build-obs-linux

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          cmake \
          git \
          ninja-build \
          pkg-config \
          libssl-dev \
          qt6-base-dev \
          libqt6core6 \
          libqt6gui6 \
          libqt6widgets6

    - name: Download OBS SDK
      uses: actions/download-artifact@v4
      with:
        name: obs-sdk-linux
        path: obs-sdk

    - name: Configure CMake
      run: |
        cmake -B build -G Ninja \
          -DCMAKE_BUILD_TYPE=Release \
          -DBUILD_LIBDATACHANNEL=ON \
          -DOBS_INCLUDE_SEARCH_PATH=$PWD/obs-sdk/include \
          -DOBS_LIB_SEARCH_PATH=$PWD/obs-sdk/lib

    - name: Build plugin
      run: |
        cd build
        ninja obs-webrtc-link

    - name: Get version
      id: version
      run: echo "version=$(cat VERSION | tr -d '\n')" >> $GITHUB_OUTPUT

    - name: Create release package
      run: |
        mkdir -p release/obs-webrtc-link
        cp build/obs-webrtc-link.so release/obs-webrtc-link/
        cp VERSION release/obs-webrtc-link/
        cp README.md release/obs-webrtc-link/
        cp CHANGELOG.md release/obs-webrtc-link/
        cd release
        tar -czf obs-webrtc-link-${{ steps.version.outputs.version }}-linux-x86_64.tar.gz obs-webrtc-link/

    - name: Upload release package
      uses: actions/upload-artifact@v4
      with:
        name: obs-webrtc-link-linux
        path: release/*.tar.gz
        retention-days: 7

  build-windows:
    name: Build Plugin (Windows)
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Setup MSVC
      uses: microsoft/setup-msbuild@v2

    - name: Get version
      id: version
      shell: pwsh
      run: |
        $version = (Get-Content VERSION).Trim()
        echo "version=$version" >> $env:GITHUB_OUTPUT

    - name: Cache OBS Studio SDK
      id: cache-obs
      uses: actions/cache@v4
      with:
        path: obs-studio-build
        key: obs-windows-sdk-32.0.2-${{ runner.os }}-v1

    - name: Build OBS Studio SDK from source
      if: steps.cache-obs.outputs.cache-hit != 'true'
      shell: pwsh
      run: |
        # Download OBS dependencies (obs-deps)
        Write-Host "Downloading OBS dependencies..."
        $obsDepsUrl = "https://github.com/obsproject/obs-deps/releases/download/2025-08-23/windows-deps-2025-08-23-x64.zip"
        Invoke-WebRequest -Uri $obsDepsUrl -OutFile "obs-deps.zip"
        Expand-Archive -Path "obs-deps.zip" -DestinationPath "obs-deps" -Force

        # Clone OBS Studio
        Write-Host "Cloning OBS Studio 32.0.2..."
        git clone --depth 1 --branch 32.0.2 https://github.com/obsproject/obs-studio.git obs-src
        cd obs-src

        # Remove platform-specific graphics libraries (not needed for SDK)
        Write-Host "Removing platform-specific graphics libraries..."
        Remove-Item -Recurse -Force libobs-d3d11 -ErrorAction SilentlyContinue
        Remove-Item -Recurse -Force libobs-winrt -ErrorAction SilentlyContinue

        # Configure OBS with deps
        Write-Host "Configuring OBS Studio SDK..."
        $depsPath = "${{ github.workspace }}\obs-deps"
        cmake -B build -G "Visual Studio 17 2022" -A x64 `
          -DCMAKE_BUILD_TYPE=Release `
          -DCMAKE_PREFIX_PATH="$depsPath" `
          -DENABLE_PLUGINS=OFF `
          -DENABLE_UI=OFF `
          -DENABLE_SCRIPTING=OFF `
          -DBUILD_TESTS=OFF `
          -DENABLE_BROWSER=OFF `
          -DCMAKE_INSTALL_PREFIX="../obs-studio-build"

        # Build just libobs
        Write-Host "Building OBS SDK libraries..."
        cmake --build build --config Release --target obs-frontend-api libobs

        # Install SDK
        Write-Host "Installing OBS SDK..."
        cmake --install build --config Release

        cd ..

        # Verify SDK installation
        if (Test-Path "obs-studio-build/include/obs.h") {
          Write-Host "OBS SDK installed successfully"
        } else {
          Write-Error "OBS SDK installation failed"
          Get-ChildItem -Path "obs-studio-build" -Recurse | Select-Object FullName
          exit 1
        }

    - name: Build plugin with OBS SDK
      shell: pwsh
      run: |
        $obsInclude = "${{ github.workspace }}/obs-studio-build/include"
        $obsLib = "${{ github.workspace }}/obs-studio-build/lib"

        Write-Host "OBS Include: $obsInclude"
        Write-Host "OBS Lib: $obsLib"

        # Verify paths exist
        if (-not (Test-Path $obsInclude)) {
          Write-Error "OBS include directory not found: $obsInclude"
          Get-ChildItem -Path "${{ github.workspace }}/obs-studio-build" -Recurse | Select-Object FullName
          exit 1
        }

        # Configure CMake with OBS SDK paths
        cmake -B build -G "Visual Studio 17 2022" -A x64 `
          -DCMAKE_BUILD_TYPE=Release `
          -DOBS_INCLUDE_SEARCH_PATH="$obsInclude" `
          -DOBS_LIB_SEARCH_PATH="$obsLib"

        # Build plugin
        cmake --build build --config Release

        # Verify plugin was built
        if (Test-Path "build/Release/obs-webrtc-link.dll") {
          Write-Host "Plugin built successfully"
        } else {
          Write-Error "Plugin build failed - DLL not found"
          Get-ChildItem -Path "build" -Recurse | Select-Object FullName
          exit 1
        }

    - name: Install Inno Setup
      shell: pwsh
      run: |
        choco install innosetup -y

    - name: Create installer script
      shell: pwsh
      run: |
        $version = "${{ steps.version.outputs.version }}"

        # Create Inno Setup script
        @"
        #define MyAppName "OBS WebRTC Link"
        #define MyAppVersion "$version"
        #define MyAppPublisher "OBS WebRTC Link Contributors"
        #define MyAppURL "https://github.com/m96-chan/OBS-WebRTC-Link"

        [Setup]
        AppId={{8F9C4D5E-6B2A-4F3C-9D8E-1A2B3C4D5E6F}
        AppName={#MyAppName}
        AppVersion={#MyAppVersion}
        AppPublisher={#MyAppPublisher}
        AppPublisherURL={#MyAppURL}
        AppSupportURL={#MyAppURL}
        AppUpdatesURL={#MyAppURL}
        DefaultDirName={autopf}\obs-studio
        DefaultGroupName={#MyAppName}
        DisableProgramGroupPage=yes
        OutputDir=release
        OutputBaseFilename=obs-webrtc-link-{#MyAppVersion}-windows-installer
        Compression=lzma
        SolidCompression=yes
        WizardStyle=modern
        ArchitecturesAllowed=x64compatible
        ArchitecturesInstallIn64BitMode=x64compatible

        [Languages]
        Name: "english"; MessagesFile: "compiler:Default.isl"

        [Files]
        Source: "build\Release\obs-webrtc-link.dll"; DestDir: "{app}\obs-plugins\64bit"; Flags: ignoreversion
        Source: "data\locale\*"; DestDir: "{app}\data\obs-plugins\obs-webrtc-link\locale"; Flags: ignoreversion recursesubdirs createallsubdirs
        Source: "README.md"; DestDir: "{app}\data\obs-plugins\obs-webrtc-link"; Flags: ignoreversion
        Source: "CHANGELOG.md"; DestDir: "{app}\data\obs-plugins\obs-webrtc-link"; Flags: ignoreversion

        [Icons]
        Name: "{group}\{cm:UninstallProgram,{#MyAppName}}"; Filename: "{uninstallexe}"

        [Code]
        function InitializeSetup(): Boolean;
        var
          OBSPath: String;
        begin
          Result := True;
          // Check if OBS Studio is installed
          if not RegQueryStringValue(HKLM, 'SOFTWARE\OBS Studio', 'InstallPath', OBSPath) then
          begin
            if not RegQueryStringValue(HKCU, 'SOFTWARE\OBS Studio', 'InstallPath', OBSPath) then
            begin
              if MsgBox('OBS Studio installation not detected. Do you want to continue anyway?', mbConfirmation, MB_YESNO) = IDNO then
              begin
                Result := False;
              end;
            end;
          end;
        end;
        "@ | Out-File -FilePath "installer.iss" -Encoding UTF8

    - name: Build installer
      shell: pwsh
      run: |
        & "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" "installer.iss"

    - name: Create portable ZIP
      shell: pwsh
      run: |
        New-Item -ItemType Directory -Force -Path "release/obs-webrtc-link"
        New-Item -ItemType Directory -Force -Path "release/obs-webrtc-link/obs-plugins/64bit"
        New-Item -ItemType Directory -Force -Path "release/obs-webrtc-link/data/obs-plugins/obs-webrtc-link"

        # Copy plugin DLL
        Copy-Item "build/Release/obs-webrtc-link.dll" "release/obs-webrtc-link/obs-plugins/64bit/"

        # Copy data files
        if (Test-Path "data/locale") {
          Copy-Item -Recurse "data/locale" "release/obs-webrtc-link/data/obs-plugins/obs-webrtc-link/"
        }

        # Copy documentation
        Copy-Item "README.md" "release/obs-webrtc-link/data/obs-plugins/obs-webrtc-link/"
        Copy-Item "CHANGELOG.md" "release/obs-webrtc-link/data/obs-plugins/obs-webrtc-link/"
        Copy-Item "BUILD.md" "release/obs-webrtc-link/data/obs-plugins/obs-webrtc-link/"

        # Create installation instructions
        @"
        # OBS WebRTC Link v${{ steps.version.outputs.version }} - Windows Portable

        ## Installation Instructions

        1. Close OBS Studio if it's running
        2. Copy the contents of this folder to your OBS Studio installation directory:
           - Typically: C:\Program Files\obs-studio\
        3. The plugin DLL should be in: obs-plugins\64bit\obs-webrtc-link.dll
        4. Start OBS Studio

        ## Uninstallation

        Delete the following files:
        - obs-plugins\64bit\obs-webrtc-link.dll
        - data\obs-plugins\obs-webrtc-link\ (folder)

        ## Support

        For issues and support: https://github.com/m96-chan/OBS-WebRTC-Link/issues
        "@ | Out-File -FilePath "release/obs-webrtc-link/INSTALL.txt" -Encoding UTF8

        # Create ZIP
        Compress-Archive -Path "release/obs-webrtc-link/*" -DestinationPath "release/obs-webrtc-link-${{ steps.version.outputs.version }}-windows-portable.zip"

    - name: Upload release packages
      uses: actions/upload-artifact@v4
      with:
        name: obs-webrtc-link-windows
        path: |
          release/*.exe
          release/*.zip
        retention-days: 7

  build-macos:
    name: Build Plugin (macOS)
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Get version
      id: version
      run: echo "version=$(cat VERSION | tr -d '\n')" >> $GITHUB_OUTPUT

    - name: Install dependencies
      run: |
        brew install cmake ninja pkg-config openssl

    - name: Cache OBS Studio SDK
      id: cache-obs
      uses: actions/cache@v4
      with:
        path: obs-studio-build
        key: obs-macos-sdk-32.0.2-${{ runner.os }}-v1

    - name: Build OBS Studio SDK from source
      if: steps.cache-obs.outputs.cache-hit != 'true'
      run: |
        # Clone OBS Studio
        echo "Cloning OBS Studio 32.0.2..."
        git clone --depth 1 --branch 32.0.2 https://github.com/obsproject/obs-studio.git obs-src
        cd obs-src

        # Remove libobs-metal (requires Swift compiler not available in CI)
        echo "Removing libobs-metal directory to avoid Swift dependency..."
        rm -rf libobs-metal

        # Configure OBS (headers and libraries only, minimal build)
        echo "Configuring OBS Studio SDK..."
        cmake -B build -G Xcode \
          -DCMAKE_BUILD_TYPE=Release \
          -DENABLE_PLUGINS=OFF \
          -DENABLE_UI=OFF \
          -DENABLE_SCRIPTING=OFF \
          -DBUILD_TESTS=OFF \
          -DENABLE_BROWSER=OFF \
          -DCMAKE_INSTALL_PREFIX="../obs-studio-build"

        # Build just libobs
        echo "Building OBS SDK libraries..."
        cmake --build build --config Release --target libobs obs-frontend-api

        # Install SDK
        echo "Installing OBS SDK..."
        cmake --install build --config Release

        cd ..

        # Verify SDK installation
        if [ -f "obs-studio-build/include/obs.h" ]; then
          echo "OBS SDK installed successfully"
        else
          echo "OBS SDK installation failed"
          exit 1
        fi

    - name: Build plugin with OBS SDK
      run: |
        OBS_INCLUDE="${{ github.workspace }}/obs-studio-build/include"
        OBS_LIB="${{ github.workspace }}/obs-studio-build/lib"

        echo "OBS Include: $OBS_INCLUDE"
        echo "OBS Lib: $OBS_LIB"

        # Verify paths exist
        if [ ! -d "$OBS_INCLUDE" ]; then
          echo "OBS include directory not found: $OBS_INCLUDE"
          find obs-studio-build -type d
          exit 1
        fi

        cmake -B build -G Xcode \
          -DCMAKE_BUILD_TYPE=Release \
          -DOBS_INCLUDE_SEARCH_PATH="$OBS_INCLUDE" \
          -DOBS_LIB_SEARCH_PATH="$OBS_LIB"

        cmake --build build --config Release

        # Verify plugin was built (Xcode puts output in Release subdirectory)
        if [ -f "build/Release/obs-webrtc-link.so" ]; then
          echo "Plugin built successfully"
          # Copy to expected location for packaging
          cp build/Release/obs-webrtc-link.so build/
        else
          echo "Plugin build failed - .so not found"
          find build -name "*.so" -o -name "*.dylib"
          exit 1
        fi

    - name: Create portable package
      run: |
        mkdir -p release/obs-webrtc-link.plugin/Contents/MacOS
        mkdir -p release/obs-webrtc-link.plugin/Contents/Resources

        # Copy plugin binary
        cp build/obs-webrtc-link.so release/obs-webrtc-link.plugin/Contents/MacOS/

        # Copy data files if they exist
        if [ -d "data/locale" ]; then
          cp -r data/locale release/obs-webrtc-link.plugin/Contents/Resources/
        fi

        # Create Info.plist
        cat > release/obs-webrtc-link.plugin/Contents/Info.plist << EOF
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
        <plist version="1.0">
        <dict>
          <key>CFBundleDevelopmentRegion</key>
          <string>English</string>
          <key>CFBundleExecutable</key>
          <string>obs-webrtc-link.so</string>
          <key>CFBundleIdentifier</key>
          <string>com.github.m96-chan.obs-webrtc-link</string>
          <key>CFBundleInfoDictionaryVersion</key>
          <string>6.0</string>
          <key>CFBundleName</key>
          <string>OBS WebRTC Link</string>
          <key>CFBundleShortVersionString</key>
          <string>${{ steps.version.outputs.version }}</string>
          <key>CFBundleVersion</key>
          <string>${{ steps.version.outputs.version }}</string>
        </dict>
        </plist>
        EOF

        # Create installation instructions
        cat > release/INSTALL-MACOS.txt << 'EOF'
        # OBS WebRTC Link v${{ steps.version.outputs.version }} - macOS Installation

        ## Installation Instructions

        **IMPORTANT: This plugin is unsigned. You will need to manually allow it.**

        1. Close OBS Studio if it's running
        2. Copy the obs-webrtc-link.plugin folder to:
           ~/Library/Application Support/obs-studio/plugins/

        3. First time running:
           - Open OBS Studio
           - macOS will block the plugin
           - Go to System Settings → Privacy & Security
           - Click "Allow Anyway" next to the blocked plugin message
           - Restart OBS Studio

        ## Alternative: Remove quarantine attribute

        If you trust this plugin, you can remove the quarantine attribute:

        ```bash
        cd ~/Library/Application\ Support/obs-studio/plugins/
        xattr -dr com.apple.quarantine obs-webrtc-link.plugin
        ```

        ## Uninstallation

        Delete the plugin folder:
        ```bash
        rm -rf ~/Library/Application\ Support/obs-studio/plugins/obs-webrtc-link.plugin
        ```

        ## Support

        For issues: https://github.com/m96-chan/OBS-WebRTC-Link/issues
        EOF

        cp README.md release/
        cp CHANGELOG.md release/
        cp BUILD.md release/

        # Create ZIP
        cd release
        zip -r obs-webrtc-link-${{ steps.version.outputs.version }}-macos-unsigned.zip \
          obs-webrtc-link.plugin \
          INSTALL-MACOS.txt \
          README.md \
          CHANGELOG.md \
          BUILD.md

    - name: Upload release package
      uses: actions/upload-artifact@v4
      with:
        name: obs-webrtc-link-macos
        path: release/*.zip
        retention-days: 7

  # ============================================================================
  # Create GitHub Release
  # ============================================================================

  create-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    needs: [build-linux, build-windows, build-macos]
    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Get version
      id: version
      run: |
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          echo "tag=${{ github.event.inputs.tag }}" >> $GITHUB_OUTPUT
          echo "version=${${{ github.event.inputs.tag }}#v}" >> $GITHUB_OUTPUT
        else
          echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          echo "version=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
        fi

    - name: Download all artifacts
      uses: actions/download-artifact@v4
      with:
        path: artifacts

    - name: Display structure of downloaded files
      run: ls -R artifacts

    - name: Extract release notes from CHANGELOG
      id: extract_notes
      run: |
        # Extract the section for this version from CHANGELOG.md
        VERSION="${{ steps.version.outputs.version }}"

        # Get content between version header and next version or end
        NOTES=$(awk "/^## \[$VERSION\]/,/^## \[/" CHANGELOG.md | head -n -1 | tail -n +2)

        # If no specific version notes found, use Unreleased section
        if [ -z "$NOTES" ]; then
          NOTES=$(awk '/^## \[Unreleased\]/,/^## \[/' CHANGELOG.md | head -n -1 | tail -n +2)
        fi

        # Save to file for use in release
        echo "$NOTES" > release_notes.md

        # Add download links
        echo "" >> release_notes.md
        echo "## Downloads" >> release_notes.md
        echo "" >> release_notes.md
        echo "- **Linux**: \`obs-webrtc-link-$VERSION-linux-x86_64.tar.gz\`" >> release_notes.md
        echo "- **Windows**: \`obs-webrtc-link-$VERSION-windows-source.zip\` (requires local build)" >> release_notes.md
        echo "- **macOS**: \`obs-webrtc-link-$VERSION-macos-source.zip\` (requires local build)" >> release_notes.md
        echo "" >> release_notes.md
        echo "See [BUILD.md](https://github.com/${{ github.repository }}/blob/main/BUILD.md) for build instructions." >> release_notes.md

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.version.outputs.tag }}
        name: Release ${{ steps.version.outputs.tag }}
        body_path: release_notes.md
        draft: false
        prerelease: ${{ contains(steps.version.outputs.version, 'alpha') || contains(steps.version.outputs.version, 'beta') || contains(steps.version.outputs.version, 'rc') }}
        files: |
          artifacts/obs-webrtc-link-linux/*.tar.gz
          artifacts/obs-webrtc-link-windows/*.zip
          artifacts/obs-webrtc-link-macos/*.zip
        fail_on_unmatched_files: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ============================================================================
  # Summary
  # ============================================================================

  release-summary:
    name: Release Summary
    runs-on: ubuntu-latest
    needs: [create-release]
    if: always()

    steps:
    - name: Summary
      run: |
        echo "# Release Summary"
        echo ""
        echo "Release created successfully!"
        echo ""
        echo "- Linux plugin binary: ✓"
        echo "- Windows source package: ✓"
        echo "- macOS source package: ✓"
        echo "- GitHub Release: ✓"
        echo ""
        echo "The release is now available at:"
        echo "https://github.com/${{ github.repository }}/releases"
